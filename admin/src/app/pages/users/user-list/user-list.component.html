<div class="space-y-6">
  <!-- Header & Actions -->
  <cms-page-header 
    [title]="translate.instant('userManagement.title')" 
    [subtitle]="translate.instant('userManagement.subtitle')"
  >
    <cms-button 
      [label]="translate.instant('userManagement.addUser')" 
      iconName="plus" 
      color="primary"
      (pressed)="openCreateModal()"
    ></cms-button>
  </cms-page-header>

  <!-- Filters -->
  <cms-card padding="md">
    <cms-search-bar 
      [(value)]="searchTerm" 
      [placeholder]="translate.instant('common.search')"
      (searchChange)="onSearch()"
    ></cms-search-bar>
  </cms-card>

  <!-- Table -->
  <cms-card padding="none">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700/50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              {{ translate.instant('common.name') }}
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              {{ translate.instant('common.email') }}
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              {{ translate.instant('userManagement.role') }}
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              {{ translate.instant('common.status') }}
            </th>
            <th scope="col" class="relative px-6 py-3">
              <span class="sr-only">{{ translate.instant('common.actions') }}</span>
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
          @for (user of users; track user) {
            <tr  [ngClass]="'user.id.' + user.id">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 dark:text-primary-400 font-bold">
                    {{ user.firstName[0] }}{{ user.lastName[0] }}
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900 dark:text-white">{{ user.fullName }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500 dark:text-gray-400">{{ user.email }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <cms-badge 
                  [text]="getUserRoleLabel(user.role)"
                  [color]="user.role === UserRole.Admin ? 'purple' : user.role === UserRole.Developer ? 'blue' : 'gray'"
                ></cms-badge>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <cms-badge 
                  [text]="user.isActive ? translate.instant('common.active') : translate.instant('common.inactive')"
                  [color]="user.isActive ? 'success' : 'error'"
                ></cms-badge>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <div class="flex items-center justify-end gap-2">
                  <cms-button
                    iconName="edit"
                    [iconOnly]="true"
                    color="primary"
                    iconOnlyVariant="ghost"
                    size="sm"
                    [title]="translate.instant('common.edit')"
                    (pressed)="onEdit(user)"
                  ></cms-button>
                  <cms-button
                    [iconName]="user.isActive ? 'lock' : 'check'"
                    [iconOnly]="true"
                    [color]="user.isActive ? 'warning' : 'success'"
                    iconOnlyVariant="ghost"
                    size="sm"
                    [title]="user.isActive ? translate.instant('userManagement.deactivate') : translate.instant('userManagement.activate')"
                    (pressed)="onToggleStatus(user)"
                  ></cms-button>
                  <cms-button
                    iconName="trash"
                    [iconOnly]="true"
                    color="danger"
                    iconOnlyVariant="ghost"
                    size="sm"
                    [title]="translate.instant('common.delete')"
                    (pressed)="onDelete(user)"
                  ></cms-button>
                </div>
              </td>
            </tr>
          }
          <!-- Loading State -->
          @if (isLoading) {
            <tr>
              <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                <div class="flex items-center justify-center gap-2">
                  <cms-icon name="spinner" class="animate-spin"></cms-icon>
                  {{ translate.instant('common.loading') }}
                </div>
              </td>
            </tr>
          } @else if (users.length === 0) {
            <tr>
              <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                {{ translate.instant('userManagement.noUsersFound') }}
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="bg-gray-50 dark:bg-gray-700/50 px-4 py-3 border-t border-gray-200 dark:border-gray-700">
      <cms-pagination
        [currentPage]="pageNumber"
        [totalPages]="Math.ceil(totalCount / pageSize)"
        [pageSize]="pageSize"
        [totalCount]="totalCount"
        (pageChange)="changePage($event)"
      ></cms-pagination>
    </div>
  </cms-card>
</div>

<!-- Create/Edit Modal -->
<cms-dialog
  [isOpen]="isModalOpen"
  [title]="selectedUser ? translate.instant('userManagement.editUser') : translate.instant('userManagement.addUser')"
  (dismiss)="closeModal()"
>
  @if (isModalOpen) {
    <cms-user-form
      [user]="selectedUser"
      (cancelled)="closeModal()"
      (saved)="onUserSaved()"
    ></cms-user-form>
  }
</cms-dialog>
